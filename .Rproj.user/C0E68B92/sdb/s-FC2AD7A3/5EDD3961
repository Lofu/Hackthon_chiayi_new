{
    "collab_server" : "",
    "contents" : "# library---------\nlibrary(shinydashboard)\nlibrary(shiny)\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(highcharter)\nlibrary(leaflet)\nlibrary(rgdal)\nlibrary(maptools)\nlibrary(magrittr)\nlibrary(ggthemes)\nlibrary(readxl)\nlibrary(RColorBrewer)\nlibrary(ggThemeAssist)\noptions(max.print=\"75\", digits = 4, scipen = 999)\n# load data----\n# 鄉鎮市地圖底圖設定，於開放資料平台下載----\ntw <- readOGR(dsn ='leaflet_map/TOWN_MOI_1060525' ,\n              layer='TOWN_MOI_1060525', stringsAsFactors = F,\n              verbose = F,encoding = \"utf8\")\n# Windows系統編碼問題，MAC系統不須執行\n#tw$COUNTYNAME <- iconv(tw$COUNTYNAME,from =\"utf8\" ,to=\"big5\")\n#tw$TOWNNAME <- iconv(tw$TOWNNAME,from =\"utf8\" ,to=\"big5\")\n# 崇甫的資料----\ncluster <- read.csv(\"data/clustering_index.csv\",header = T,fileEncoding = 'big5') %>% select(-1)\n# 家丞的資料----\nDNRA <- read.csv(\"data/DNRA.csv\",header = T,fileEncoding = 'big5') %>% select(-1)\nDNRB <- read.csv(\"data/DNRB.csv\",header = T,fileEncoding = 'big5') %>% select(-1)\nDH<-read_excel(\"data/嘉義市醫療院所資料集.xlsx\")\nDO<-read_excel(\"data/醫療人員統計-醫師及護理師(長資料整合).xlsx\")\ncolnames(DO)<-c(\"area\",\"year\",\"doctor\",\"nurse\",\"population\",\"perdoctor\",\"pernurse\")\n#醫療院所分佈用icon----\n# c(\"#A88B14\",\"#5A7DE0\",\"#827E6D\",\"#FFA500\",\"#332D15\")\npal2 <- colorFactor(palette=c(\"#00008B\", \"#00CD66\", \"#1C1C1C\",\"#FFA500\" , \"#FF1493\"), domain = c(\"西區\", \"東區\",\"朴子市\",\"竹崎鄉\",\"大林鎮\"))\npal3<- colorFactor(palette=c(\"#D80027\",\"#BD7BE3\",\"#0038F0\"), domain = c(\"地區醫院\",\"區域醫院\",\"基層院所\"))\nbuildIcons <- iconList(\n  區域醫院 = makeIcon(\"data/區域醫院.png\"),\n  地區醫院 = makeIcon(\"data/地區醫院.png\"),\n  基層院所 = makeIcon(\"data/診所.png\")\n)\nleafIcons <- icons(\n  iconUrl = if (DH$level==\"地區醫院\") {\n    \"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CjxwYXRoIHN0eWxlPSJmaWxsOiMwMDQ3OUI7IiBkPSJNMzA5LjcxNSwxNC42NGMtMjkuNjU5LTE3LjEyNC01Ni41MzEtMTguNzEzLTc1LjkzNS03LjQzOEwxMjcuMDUzLDY5LjIyNSAgYzAuMDYyLTAuMDM2LDAuMTI2LTAuMDY4LDAuMTg3LTAuMTA0Yy0xOS4yNjMsMTEuMDg2LTMxLjIxOCwzNC43OTYtMzEuMzE0LDY4LjU0NUM5NS43MzUsMjA1LjM5MiwxOTYuNDUxLDQ5Ni42NywyMDEuNzUyLDUxMiAgbDEwNi43MjgtNjIuMDIzYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTEsMTA3LjU5My0yNTEuMTE2QzQxNi4yNjYsMTMxLjE0MywzNjguNjQ4LDQ4LjY2NCwzMDkuNzE1LDE0LjY0eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA1RUNGOyIgZD0iTTEyNy4wNTMsNjkuMjI1TDIzMy43ODIsNy4yMDJjMTkuNDA0LTExLjI3Nyw0Ni4yNzUtOS42ODcsNzUuOTM1LDcuNDM4TDIwMi45ODgsNzYuNjYzICBDMTczLjMyOCw1OS41NCwxNDYuNDU3LDU3Ljk1LDEyNy4wNTMsNjkuMjI1eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA0NzlCOyIgZD0iTTIwMi45ODgsNzYuNjYzTDMwOS43MTUsMTQuNjRjNTguOTMyLDM0LjAyNCwxMDYuNTUxLDExNi41MDMsMTA2LjM1OSwxODQuMjIxICBjLTAuMTkyLDY3LjcyNS0xMDIuMjIzLDI0MS45NDYtMTA3LjU5MywyNTEuMTE2TDIwMS43NTMsNTEyYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTIsMTA3LjU5My0yNTEuMTE2ICBDMzA5LjUzOSwxOTMuMTY2LDI2MS45MTksMTEwLjY4NywyMDIuOTg4LDc2LjY2M3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6IzAwNEZBRTsiIGQ9Ik0yMDIuOTg4LDc2LjY2M2M1OC45MzIsMzQuMDI0LDEwNi41NTEsMTE2LjUwMywxMDYuMzU5LDE4NC4yMjEgIEMzMDkuMTU0LDMyOC42MDksMjA3LjEyMyw1MDIuODMsMjAxLjc1Myw1MTJDMTk2LjQ1Miw0OTYuNjcsOTUuNzM1LDIwNS4zOTIsOTUuOTI3LDEzNy42NjcgIEM5Ni4xMTksNjkuOTQ5LDE0NC4wNDksNDIuNjM1LDIwMi45ODgsNzYuNjYzeiIvPgo8Zz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS40NDUsMTQ4LjYxNiAxOTIuNTg2LDE3MC4wMzcgMTkyLjU0NywxODMuNzY4IDE4NC44ODgsMTc5LjI1NSAxODQuODg4LDEyMi44OTEgICAgMTQ4LjM3OSwxMDEuODEzIDExMS41MTksMTIzLjIzMyAxMTEuMDg2LDI3NS45NzcgMTQ3LjU5NiwyOTcuMDU2IDE4NC40NTUsMjc1LjYzNiAxODQuNTA0LDI1OC40NTggMTkyLjMyMiwyNjIuOTcyICAgIDE5Mi4xNTIsMzIyLjc4MSAyMjkuMDk1LDM0My44NTkgMjY1Ljk1MywzMjIuNDM5IDI2NS45NTMsMTY5LjY5NSAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojQUNBQkIxOyIgcG9pbnRzPSIxNDcuNzY1LDIzNy4yNDcgMTg0LjYyNSwyMTUuODI3IDE4NC40NTUsMjc1LjYzNiAxNDcuNTk2LDI5Ny4wNTYgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTQ4LjAyOSwyMDAuNjc1IDE4NC44ODgsMTc5LjI1NSAyMjkuMjg1LDIwNC45NzkgMTkyLjQyNSwyMjYuNCAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRTBFMEUyOyIgcG9pbnRzPSIxMTEuNTE5LDEyMy4yMzMgMTQ4LjM3OSwxMDEuODEzIDE4NC44ODgsMTIyLjg5MSAxNDguMDI5LDE0NC4zMTIgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0FDQUJCMTsiIHBvaW50cz0iMTQ4LjAyOSwxNDQuMzEyIDE4NC44ODgsMTIyLjg5MSAxODQuODg4LDE3OS4yNTUgMTQ4LjAyOSwyMDAuNjc1ICAiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS4wOTUsMTkxLjExNSAyNjUuOTUzLDE2OS42OTUgMjY1Ljk1MywzMjIuNDM5IDIyOS4wOTUsMzQzLjg1OSAgIi8+CjwvZz4KPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTkyLjU4NiwxNzAuMDM3IDIyOS40NDUsMTQ4LjYxNiAyNjUuOTUzLDE2OS42OTUgMjI5LjA5NSwxOTEuMTE1ICIvPgo8cG9seWdvbiBzdHlsZT0iZmlsbDojQzZDNUNCOyIgcG9pbnRzPSIyMjkuMDk1LDE5MS4xMTUgMjI5LjA5NSwzNDMuODU5IDE5Mi4xNTIsMzIyLjc4MSAxOTIuMzIyLDI2Mi45NzIgMTQ3Ljc2NSwyMzcuMjQ3ICAgMTQ3LjU5NiwyOTcuMDU2IDExMS4wODYsMjc1Ljk3NyAxMTEuNTE5LDEyMy4yMzMgMTQ4LjAyOSwxNDQuMzEyIDE0OC4wMjksMjAwLjY3NSAxOTIuNDI1LDIyNi40IDE5Mi41ODYsMTcwLjAzNyAiLz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==\"\n  } else if (DH$level==\"區域醫院\") {\n    \"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ2MCA0NjAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ2MCA0NjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRUYxRjRCOyIgZD0iTTIzMCwwdjQwYzc1LjI2MywwLDEzNi41LDYxLjIyLDEzNi41LDEzNi41YzAsNzUuMjYzLTYxLjIzNywxMzYuNS0xMzYuNSwxMzYuNXYxNDdsMTM4LjUxMS0xNzQuMTQ0ICAgYzI0Ljg2OC0zMS40NTIsMzguMDE3LTY5LjI1LDM4LjAxNy0xMDkuMzI5QzQwNi41MjcsNzkuMTkyLDMyNy4zMzUsMCwyMzAsMHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNFQTY0NTM7IiBkPSJNOTMuNSwxNzYuNUM5My41LDEwMS4yMiwxNTQuNzM3LDQwLDIzMCw0MFYwQzEzMi42NjUsMCw1My40NzMsNzkuMTkyLDUzLjQ3MywxNzYuNTI3ICAgYzAsNDAuMDc5LDEzLjE0OCw3Ny44NzcsMzguMDU0LDEwOS4zNjdMMjMwLDQ2MFYzMTNDMTU0LjczNywzMTMsOTMuNSwyNTEuNzYzLDkzLjUsMTc2LjV6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkZFMjkyOyIgZD0iTTI2Mi40NTksODB2NjQuMDQxSDMyNi41djY0LjkxOGgtNjQuMDQxVjI3M0gyMzB2NDBjNzUuMjYzLDAsMTM2LjUtNjEuMjM3LDEzNi41LTEzNi41ICAgQzM2Ni41LDEwMS4yMiwzMDUuMjYzLDQwLDIzMCw0MHY0MEgyNjIuNDU5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIGQ9Ik05My41LDE3Ni41QzkzLjUsMjUxLjc2MywxNTQuNzM3LDMxMywyMzAsMzEzdi00MGgtMzIuNDU5di02NC4wNDFIMTMzLjV2LTY0LjkxOGg2NC4wNDFWODBIMjMwVjQwICAgQzE1NC43MzcsNDAsOTMuNSwxMDEuMjIsOTMuNSwxNzYuNXoiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiMwQjM4OUM7IiBwb2ludHM9IjI2Mi40NTksMjA4Ljk1OSAzMjYuNSwyMDguOTU5IDMyNi41LDE0NC4wNDEgMjYyLjQ1OSwxNDQuMDQxIDI2Mi40NTksODAgMjMwLDgwIDIzMCwyNzMgICAgMjYyLjQ1OSwyNzMgICIvPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6IzQzNzBEOTsiIHBvaW50cz0iMTk3LjU0MSw4MCAxOTcuNTQxLDE0NC4wNDEgMTMzLjUsMTQ0LjA0MSAxMzMuNSwyMDguOTU5IDE5Ny41NDEsMjA4Ljk1OSAxOTcuNTQxLDI3MyAgICAyMzAsMjczIDIzMCw4MCAgIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==\"\n  } else { \n    \"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDMxLjc4NSAzMS43ODUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMxLjc4NSAzMS43ODU7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNMTcuOTQzLDguNzY5YzAtMC40NzktMC4zODktMC44NjgtMC44NjktMC44NjhoLTIuNTAyYy0wLjQ3OSwwLTAuODY4LDAuMzg5LTAuODY4LDAuODY4djIuMzgyaC0yLjUyMyAgICBjLTAuNDc5LDAtMC44NjgsMC4zODktMC44NjgsMC44Njh2Mi41MDFjMCwwLjQ3OSwwLjM4OSwwLjg2OSwwLjg2OCwwLjg2OWgyLjUyM3YyLjUyM2MwLDAuNDc5LDAuMzg5LDAuODY5LDAuODY4LDAuODY5aDIuNTAyICAgIGMwLjQ3OSwwLDAuODY5LTAuMzkxLDAuODY5LTAuODY5VjE1LjM5aDIuMzgxYzAuNDc5LDAsMC44NjktMC4zOSwwLjg2OS0wLjg2OVYxMi4wMmMwLTAuNDc5LTAuMzg5LTAuODY4LTAuODY5LTAuODY4aC0yLjM4MSAgICBWOC43Njl6IiBmaWxsPSIjOTMzRUM1Ii8+CgkJPHBhdGggZD0iTTE1Ljg5NCwwQzguOTk5LDAsMy4zODksNS42MDgsMy4zODksMTIuNTAyYzAsOS4yMTcsMTAuOTEzLDE4LjQ4MiwxMS4zNzcsMTguODcyYzAuNjE0LDAuNTE3LDEuNSwwLjU0OSwyLjE1MiwwLjA4MSAgICBjMC40NjgtMC4zMzcsMTEuNDc5LTguMzgsMTEuNDc5LTE4Ljk1M0MyOC4zOTYsNS42MDgsMjIuNzg3LDAsMTUuODk0LDB6IE0xNy4zMSwyNi41MzZjLTAuNzUxLDAuNzAzLTEuOTI1LDAuNjc3LTIuNjQ0LTAuMDYgICAgYy0zLjI5Ni0zLjM2Ny03Ljc3LTkuMDQxLTcuNzctMTMuOTc2YzAtNC45NTksNC4wMzctOC45OTYsOC45OTgtOC45OTZjNC45NTksMCw4Ljk5Niw0LjAzNyw4Ljk5Niw4Ljk5NiAgICBDMjQuODg5LDE4LjQ3NywyMC4yNzcsMjMuNzU4LDE3LjMxLDI2LjUzNnoiIGZpbGw9IiM5MzNFQzUiLz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K\"\n  },\n  iconWidth = 38, iconHeight = 95,\n  iconAnchorX = 22, iconAnchorY = 94)\nhtml_legend <-\"<img src='data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CjxwYXRoIHN0eWxlPSJmaWxsOiMwMDQ3OUI7IiBkPSJNMzA5LjcxNSwxNC42NGMtMjkuNjU5LTE3LjEyNC01Ni41MzEtMTguNzEzLTc1LjkzNS03LjQzOEwxMjcuMDUzLDY5LjIyNSAgYzAuMDYyLTAuMDM2LDAuMTI2LTAuMDY4LDAuMTg3LTAuMTA0Yy0xOS4yNjMsMTEuMDg2LTMxLjIxOCwzNC43OTYtMzEuMzE0LDY4LjU0NUM5NS43MzUsMjA1LjM5MiwxOTYuNDUxLDQ5Ni42NywyMDEuNzUyLDUxMiAgbDEwNi43MjgtNjIuMDIzYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTEsMTA3LjU5My0yNTEuMTE2QzQxNi4yNjYsMTMxLjE0MywzNjguNjQ4LDQ4LjY2NCwzMDkuNzE1LDE0LjY0eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA1RUNGOyIgZD0iTTEyNy4wNTMsNjkuMjI1TDIzMy43ODIsNy4yMDJjMTkuNDA0LTExLjI3Nyw0Ni4yNzUtOS42ODcsNzUuOTM1LDcuNDM4TDIwMi45ODgsNzYuNjYzICBDMTczLjMyOCw1OS41NCwxNDYuNDU3LDU3Ljk1LDEyNy4wNTMsNjkuMjI1eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA0NzlCOyIgZD0iTTIwMi45ODgsNzYuNjYzTDMwOS43MTUsMTQuNjRjNTguOTMyLDM0LjAyNCwxMDYuNTUxLDExNi41MDMsMTA2LjM1OSwxODQuMjIxICBjLTAuMTkyLDY3LjcyNS0xMDIuMjIzLDI0MS45NDYtMTA3LjU5MywyNTEuMTE2TDIwMS43NTMsNTEyYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTIsMTA3LjU5My0yNTEuMTE2ICBDMzA5LjUzOSwxOTMuMTY2LDI2MS45MTksMTEwLjY4NywyMDIuOTg4LDc2LjY2M3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6IzAwNEZBRTsiIGQ9Ik0yMDIuOTg4LDc2LjY2M2M1OC45MzIsMzQuMDI0LDEwNi41NTEsMTE2LjUwMywxMDYuMzU5LDE4NC4yMjEgIEMzMDkuMTU0LDMyOC42MDksMjA3LjEyMyw1MDIuODMsMjAxLjc1Myw1MTJDMTk2LjQ1Miw0OTYuNjcsOTUuNzM1LDIwNS4zOTIsOTUuOTI3LDEzNy42NjcgIEM5Ni4xMTksNjkuOTQ5LDE0NC4wNDksNDIuNjM1LDIwMi45ODgsNzYuNjYzeiIvPgo8Zz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS40NDUsMTQ4LjYxNiAxOTIuNTg2LDE3MC4wMzcgMTkyLjU0NywxODMuNzY4IDE4NC44ODgsMTc5LjI1NSAxODQuODg4LDEyMi44OTEgICAgMTQ4LjM3OSwxMDEuODEzIDExMS41MTksMTIzLjIzMyAxMTEuMDg2LDI3NS45NzcgMTQ3LjU5NiwyOTcuMDU2IDE4NC40NTUsMjc1LjYzNiAxODQuNTA0LDI1OC40NTggMTkyLjMyMiwyNjIuOTcyICAgIDE5Mi4xNTIsMzIyLjc4MSAyMjkuMDk1LDM0My44NTkgMjY1Ljk1MywzMjIuNDM5IDI2NS45NTMsMTY5LjY5NSAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojQUNBQkIxOyIgcG9pbnRzPSIxNDcuNzY1LDIzNy4yNDcgMTg0LjYyNSwyMTUuODI3IDE4NC40NTUsMjc1LjYzNiAxNDcuNTk2LDI5Ny4wNTYgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTQ4LjAyOSwyMDAuNjc1IDE4NC44ODgsMTc5LjI1NSAyMjkuMjg1LDIwNC45NzkgMTkyLjQyNSwyMjYuNCAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRTBFMEUyOyIgcG9pbnRzPSIxMTEuNTE5LDEyMy4yMzMgMTQ4LjM3OSwxMDEuODEzIDE4NC44ODgsMTIyLjg5MSAxNDguMDI5LDE0NC4zMTIgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0FDQUJCMTsiIHBvaW50cz0iMTQ4LjAyOSwxNDQuMzEyIDE4NC44ODgsMTIyLjg5MSAxODQuODg4LDE3OS4yNTUgMTQ4LjAyOSwyMDAuNjc1ICAiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS4wOTUsMTkxLjExNSAyNjUuOTUzLDE2OS42OTUgMjY1Ljk1MywzMjIuNDM5IDIyOS4wOTUsMzQzLjg1OSAgIi8+CjwvZz4KPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTkyLjU4NiwxNzAuMDM3IDIyOS40NDUsMTQ4LjYxNiAyNjUuOTUzLDE2OS42OTUgMjI5LjA5NSwxOTEuMTE1ICIvPgo8cG9seWdvbiBzdHlsZT0iZmlsbDojQzZDNUNCOyIgcG9pbnRzPSIyMjkuMDk1LDE5MS4xMTUgMjI5LjA5NSwzNDMuODU5IDE5Mi4xNTIsMzIyLjc4MSAxOTIuMzIyLDI2Mi45NzIgMTQ3Ljc2NSwyMzcuMjQ3ICAgMTQ3LjU5NiwyOTcuMDU2IDExMS4wODYsMjc1Ljk3NyAxMTEuNTE5LDEyMy4yMzMgMTQ4LjAyOSwxNDQuMzEyIDE0OC4wMjksMjAwLjY3NSAxOTIuNDI1LDIyNi40IDE5Mi41ODYsMTcwLjAzNyAiLz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=='> 地區醫院 <br/>\n<img src='data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ2MCA0NjAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ2MCA0NjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRUYxRjRCOyIgZD0iTTIzMCwwdjQwYzc1LjI2MywwLDEzNi41LDYxLjIyLDEzNi41LDEzNi41YzAsNzUuMjYzLTYxLjIzNywxMzYuNS0xMzYuNSwxMzYuNXYxNDdsMTM4LjUxMS0xNzQuMTQ0ICAgYzI0Ljg2OC0zMS40NTIsMzguMDE3LTY5LjI1LDM4LjAxNy0xMDkuMzI5QzQwNi41MjcsNzkuMTkyLDMyNy4zMzUsMCwyMzAsMHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNFQTY0NTM7IiBkPSJNOTMuNSwxNzYuNUM5My41LDEwMS4yMiwxNTQuNzM3LDQwLDIzMCw0MFYwQzEzMi42NjUsMCw1My40NzMsNzkuMTkyLDUzLjQ3MywxNzYuNTI3ICAgYzAsNDAuMDc5LDEzLjE0OCw3Ny44NzcsMzguMDU0LDEwOS4zNjdMMjMwLDQ2MFYzMTNDMTU0LjczNywzMTMsOTMuNSwyNTEuNzYzLDkzLjUsMTc2LjV6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkZFMjkyOyIgZD0iTTI2Mi40NTksODB2NjQuMDQxSDMyNi41djY0LjkxOGgtNjQuMDQxVjI3M0gyMzB2NDBjNzUuMjYzLDAsMTM2LjUtNjEuMjM3LDEzNi41LTEzNi41ICAgQzM2Ni41LDEwMS4yMiwzMDUuMjYzLDQwLDIzMCw0MHY0MEgyNjIuNDU5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIGQ9Ik05My41LDE3Ni41QzkzLjUsMjUxLjc2MywxNTQuNzM3LDMxMywyMzAsMzEzdi00MGgtMzIuNDU5di02NC4wNDFIMTMzLjV2LTY0LjkxOGg2NC4wNDFWODBIMjMwVjQwICAgQzE1NC43MzcsNDAsOTMuNSwxMDEuMjIsOTMuNSwxNzYuNXoiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiMwQjM4OUM7IiBwb2ludHM9IjI2Mi40NTksMjA4Ljk1OSAzMjYuNSwyMDguOTU5IDMyNi41LDE0NC4wNDEgMjYyLjQ1OSwxNDQuMDQxIDI2Mi40NTksODAgMjMwLDgwIDIzMCwyNzMgICAgMjYyLjQ1OSwyNzMgICIvPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6IzQzNzBEOTsiIHBvaW50cz0iMTk3LjU0MSw4MCAxOTcuNTQxLDE0NC4wNDEgMTMzLjUsMTQ0LjA0MSAxMzMuNSwyMDguOTU5IDE5Ny41NDEsMjA4Ljk1OSAxOTcuNTQxLDI3MyAgICAyMzAsMjczIDIzMCw4MCAgIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=='> 區域醫院 <br/> \n<img src='data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDMxLjc4NSAzMS43ODUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMxLjc4NSAzMS43ODU7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNMTcuOTQzLDguNzY5YzAtMC40NzktMC4zODktMC44NjgtMC44NjktMC44NjhoLTIuNTAyYy0wLjQ3OSwwLTAuODY4LDAuMzg5LTAuODY4LDAuODY4djIuMzgyaC0yLjUyMyAgICBjLTAuNDc5LDAtMC44NjgsMC4zODktMC44NjgsMC44Njh2Mi41MDFjMCwwLjQ3OSwwLjM4OSwwLjg2OSwwLjg2OCwwLjg2OWgyLjUyM3YyLjUyM2MwLDAuNDc5LDAuMzg5LDAuODY5LDAuODY4LDAuODY5aDIuNTAyICAgIGMwLjQ3OSwwLDAuODY5LTAuMzkxLDAuODY5LTAuODY5VjE1LjM5aDIuMzgxYzAuNDc5LDAsMC44NjktMC4zOSwwLjg2OS0wLjg2OVYxMi4wMmMwLTAuNDc5LTAuMzg5LTAuODY4LTAuODY5LTAuODY4aC0yLjM4MSAgICBWOC43Njl6IiBmaWxsPSIjOTMzRUM1Ii8+CgkJPHBhdGggZD0iTTE1Ljg5NCwwQzguOTk5LDAsMy4zODksNS42MDgsMy4zODksMTIuNTAyYzAsOS4yMTcsMTAuOTEzLDE4LjQ4MiwxMS4zNzcsMTguODcyYzAuNjE0LDAuNTE3LDEuNSwwLjU0OSwyLjE1MiwwLjA4MSAgICBjMC40NjgtMC4zMzcsMTEuNDc5LTguMzgsMTEuNDc5LTE4Ljk1M0MyOC4zOTYsNS42MDgsMjIuNzg3LDAsMTUuODk0LDB6IE0xNy4zMSwyNi41MzZjLTAuNzUxLDAuNzAzLTEuOTI1LDAuNjc3LTIuNjQ0LTAuMDYgICAgYy0zLjI5Ni0zLjM2Ny03Ljc3LTkuMDQxLTcuNzctMTMuOTc2YzAtNC45NTksNC4wMzctOC45OTYsOC45OTgtOC45OTZjNC45NTksMCw4Ljk5Niw0LjAzNyw4Ljk5Niw4Ljk5NiAgICBDMjQuODg5LDE4LjQ3NywyMC4yNzcsMjMuNzU4LDE3LjMxLDI2LjUzNnoiIGZpbGw9IiM5MzNFQzUiLz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K'>基層院所\"\n# 分群的資料----\nclusteringmap <- read.csv(\"data/clusteringmap.csv\",header = T,fileEncoding = 'big5') %>% select(-1)\n# 昶志的資料----\nwhite=read.csv(file=\"data/嘉義年度疾病發生率.csv\",h=T,fileEncoding = \"big5\")\ncounty <- tw$COUNTYNAME[which(tw$COUNTYNAME %in% c(\"嘉義縣\",\"嘉義市\"))]\ncounty <- as.data.frame(county)\ncounty <- county %>% mutate(city=tw$TOWNNAME[which(tw$COUNTYNAME %in% c(\"嘉義縣\",\"嘉義市\"))])\ncolnames(white)[1]=\"city\"\nwhite<- inner_join(county,white,by=c(\"city\"))\n\n#調整分群地圖顏色----\ncol.raw <-  c(\"#FB9A99\",\"#A6CEE3\",\"#1F78B4\",\"#B2DF8A\",\"#33A02C\",\"#E31A1C\",\"#FDBF6F\"\n              ,\"#FF7F00\",\"#CAB2D6\",\"#6A3D9A\") \npal <- colorFactor(\n  palette = c(col.raw[1],col.raw[2],col.raw[3],col.raw[4],col.raw[5]),\n  domain = clusteringmap$clustering\n)\n# 調整雷達塗顏色highcharter color----\ncol.raw <-  c(\"#FB9A99\",\"#A6CEE3\",\"#1F78B4\",\"#B2DF8A\",\"#33A02C\",\"#E31A1C\",\"#FDBF6F\"\n              ,\"#FF7F00\",\"#CAB2D6\",\"#6A3D9A\") \ncbind(grDevices::col2rgb(col.raw),3) -> col\n\n# ui----\nui <- dashboardPage(skin = \"yellow\",\n                    dashboardHeader(title = \"Hackthon for Chiayi City\",titleWidth = 200),\n                    # sidebarMenu----\n                    dashboardSidebar(width = 200,\n                                     sidebarMenu(\n                                       menuItem(\"疾病發生率\", tabName = \"overview\", icon = icon(\"percent\")),\n                                       menuItem(\"相關性及趨勢分析\", tabName = \"area\", icon = icon(\"line-chart\")),\n                                       menuItem(\"癌症發生率之分群分析\", tabName = \"clustering\", icon = icon(\"users\")),\n                                       menuItem(\"醫療資源分布\", tabName = \"hospitalmap\", icon = icon(\"ambulance\")),\n                                       menuItem(\"作者簡介\", tabName = \"writer\", icon = icon(\"address-card\"))\n                                     ),h4(\"Hi All :\",style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n                                     p(\"We are a group of enthusiast in data science from different fields who wish to contribute to the people and the government through open materials. The dashboard providesInstant access to search the data visualization and compare with different county in Chiayi.\nThe dashboard contains occur rate of cancer,insurance premium,group definition and medical resources.\",\n                                       style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n                                     h4(strong(\"蚵麥拉團隊簡介：\")),\n                                     p(a(\"1. 楊崇甫(Alger)-Titansoft\",\n                                         href=\"https://www.linkedin.com/in/chung-fu-yang-291242124/\"),\n                                       style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n                                     p(a(\"2. 林昶志(Rex)-元大金控\",href=\"https://www.linkedin.com/in/chang-chih-lin-862236147/\"),\n                                       style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n                                     p(a(\"3. 韓鈺瑩(Abgail)-政大統計所\",href = 'https://www.linkedin.com/in/yu-ying-han-a70185142/'),\n                                       style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n                                     p(a(\"4. 陳家丞(Michael)-玉山金控\",href=\"https://www.linkedin.com/in/chia-chen-chen-97462a140/\"),\n                                       style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\"),\n                                     p(a(\"5. 楊舜如(Ruby)-中正高齡所\",href=\"https://www.linkedin.com/in/shun-ru-yang-a67185142/\"),\n                                       style = \"font-family: 'times'; font-si16pt ;line-height: 30px ;\",align=\"left\")\n                                     \n                    ),\n                    dashboardBody(\n                      tabItems(\n                        # 疾病發生率----\n                        tabItem(tabName = \"overview\",\n                                fluidRow(\n                                  # column(\n                                  #   width = 3,\n                                  #   box(width = NULL, status = 'info', height = 200, title = \"各類癌症相關查詢: \",\n                                  #       solidHeader = T,\n                                  #       selectInput('cancer_type', \n                                  #                   label = \"選擇癌症\",\n                                  #                   choices = unique(white$cancer),\n                                  #                   selected = \"白血病\"),\n                                  #       selectInput('year_d', \n                                  #                   label = \"年份\", \n                                  #                   choices = unique(white$year),\n                                  #                   selected = 2004)\n                                  #   )),\n                                  \n                                  column(width = 12,\n                                         box(width = NULL, solidHeader = TRUE,\n                                             leafletOutput(\"map\", height = \"600px\", width = 'auto'),\n                                             absolutePanel(top = 50, right = 100, draggable = T,\n                                                           selectInput('cancer_type', label = \"選擇癌症\",\n                                                                       choices = unique(white$cancer), multiple = FALSE, selected = \"肝及肝內膽管\"),\n                                                           selectInput('year_d', label = \"選擇年份\",\n                                                                       choices = unique(white$year), multiple = FALSE, selected = 2004)\n                                             )\n                                             \n                                         )\n                                  )\n                                  \n                                )\n                        ),\n                        # 分群----\n                        tabItem(tabName = \"clustering\",\n                                fluidRow(\n                                  column(\n                                    width = 4,\n                                    box(width = NULL, status = 'warning', height = 600,\n                                        infoBoxOutput(\"荷爾蒙失調\",width = 100),\n                                        infoBoxOutput(\"飲食問題\",width = 100),\n                                        infoBoxOutput(\"平均常態族群\",width = 100),\n                                        infoBoxOutput(\"農藥汙染\",width = 100),\n                                        infoBoxOutput(\"地域性文化\",width = 100)\n                                    )\n                                  ),\n                                  box(width = 8, status = 'warning', height = 600, title = \"分群結果：\",\n                                      highchartOutput(outputId = \"clustering\",height = 550)\n                                  )\n                                ),\n                                fluidRow(\n                                  column(width = 12,\n                                         box(width = NULL, solidHeader = TRUE,\n                                             leafletOutput(\"clustermap\", height = 500)\n                                         )\n                                  )\n                                )\n                        ),\n                        # 相關性及趨勢分析----\n                        tabItem(tabName = \"area\",\n                                fluidRow(\n                                  column(\n                                    width = 3,\n                                    box(width = NULL, status = 'primary', height = 600, title = \"功能查詢: \",\n                                        solidHeader = T,\n                                        selectInput('cancer_t', \n                                                    label = \"選擇癌症\",\n                                                    choices = unique(DNRB$cancer),\n                                                    selected = \"胰\"),\n                                        selectInput('yy', \n                                                    label = \"選擇年份\", \n                                                    choices = unique(DNRB$year),\n                                                    selected = 2008),\n                                        infoBoxOutput(\"癌症分析\",width=100),\n                                        br(),\n                                        br(),\n                                        br(),\n                                        br(),\n                                        br(),\n                                        br(),\n                                        selectInput('area_b',\n                                                    label = \"選擇鄉鎮\",\n                                                    choices = unique(DNRA$地區),\n                                                    selected = \"嘉義市東區\"),\n                                        infoBoxOutput(\"趨勢分析\",width=100)\n                                    )\n                                  ),\n                                  column(\n                                    width = 9,\n                                    tabBox(\n                                      width = 12,height = 600,\n                                      tabPanel(h5(\"癌症與保費相關性\"),height=700,\n                                               plotlyOutput(\"cancer_plot\")),\n                                      tabPanel(h5('年度趨勢圖'), height = 700,\n                                               plotlyOutput(\"year_plot\"))\n                                      \n                                    )\n                                  )\n                                )\n                        ),\n                        # 醫療資源----\n                        tabItem(tabName = \"hospitalmap\",\n                                fluidRow(\n                                  column(width = 12,\n                                         box(width = NULL, solidHeader = TRUE,\n                                             leafletOutput(\"hos_map\", height = 500)\n                                         )\n                                  )\n                                ),\n                                fluidRow(\n                                  column(\n                                    width = 3,\n                                    box(width = NULL, status = 'warning', height = 500, title = \"醫療人力查詢: \",\n                                        solidHeader = T,\n                                        infoBoxOutput(\"doctor\",width = 100),\n                                        selectInput('doctor_year', \n                                                    label = \"年份\",\n                                                    choices = unique(DO$year),\n                                                    selected = 2004),\n                                        infoBoxOutput(\"nurse\",width = 100),\n                                        selectInput('nurse_year', \n                                                    label = \"年份\",\n                                                    choices = unique(DO$year),\n                                                    selected = 2004)\n                                    )),\n                                  column(\n                                    width = 9,\n                                    tabBox(\n                                      width = 12,height=500,\n                                      tabPanel(h5('每萬人醫師數'), status = 'warning', height = 500,\n                                               plotlyOutput(\"doctor_plot\")),\n                                      tabPanel(h5('醫師年度趨勢圖'), status = 'warning', height = 500,\n                                               plotlyOutput(\"yeardoctor_plot\")),\n                                      tabPanel(h5('每萬人護理師數'), status = 'warning', height = 500,\n                                               plotlyOutput(\"nurse_plot\")),\n                                      tabPanel(h5('護理師年度趨勢圖'), status = 'warning', height = 500,\n                                               plotlyOutput(\"yearnurse_plot\")\n                                    ))\n                                )\n                              )\n                          )\n                        )\n                      )\n                    )\n\n\nserver <- function(input, output) {\n  # 發生率地圖----\n  output$map <- renderLeaflet({\n    white_1=white%>%\n      filter(cancer==input$cancer_type & year==input$year_d)\n    # filter(year==input$year_d)\n    pal <- colorNumeric(\n      palette = \"Reds\",\n      domain = white_1$RATE ,\n      reverse = F)\n    myLabelFormat = function(..., reverse_order = FALSE){\n      if(reverse_order){\n        function(type = \"numeric\", cuts){\n          cuts <- sort(cuts, decreasing = T)\n        }\n      }else{\n        labelFormat(...)\n      }\n    }\n    leaflet(\n      \n      tw %>% subset(tw$COUNTYNAME %in% white_1$county & tw$TOWNNAME %in% white_1$city)) %>%\n      \n      addPolygons(\n        \n        stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5,\n        # popup是對話框的設定\n        popup = ~sprintf(\"<strong><span style=\\\"color:gray;\\\"> 縣市 </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> 鄉鎮 </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> 發生率 </span></strong></br>\n                         <span style=\\\"font-size:40px;\\\"> %s\",COUNTYNAME, TOWNNAME ,white_1$RATE ),\n        color = ~pal(white_1$RATE)) %>%\n      addLegend(\"bottomright\", \n                values = ~white_1$RATE,\n                pal = pal,\n                #colors=rev(pal(white_1$RATE%>% sort() %>% unique())),\n                #labels=rev(white_1$RATE %>% sort() %>% unique()),\n                title = \"發生率\",\n                labFormat=labelFormat(suffix = '/十萬人'),\n                # labFormat = myLabelFormat(reverse_order = T),\n                opacity = 0.5) %>% #透明度\n      # 這個是初始畫面，定位的位置\n      setView(lng = 120.5621971, lat = 23.35, zoom = 10) %>%\n      addProviderTiles(\"CartoDB.Positron\")\n  })\n  # 相關性分析logo----\n  output$癌症分析 <- renderInfoBox({\n    infoBox(h4(\"Correlation\"),\n            p(\"。全民健保\",br(),\"。發生率\"),icon = icon(\"h-square\"),\n            color = \"light-blue\",fill =TRUE\n    )\n  })\n  # 趨勢性分析logo----\n  output$趨勢分析 <- renderInfoBox({\n    infoBox(h4(paste0(\"Cancer\",\"Trend\")),\n            p(\"。年份\",br(),\"。鄉鎮\",br(),\"。發生率\"),icon = icon(\"plus-square\"),\n            color = \"orange\",fill =TRUE\n    )\n  })\n  # 相關性分析----\noutput$cancer_plot<-renderPlotly({\n    p <- DNRB%>%\n      filter(cancer==input$cancer_t)%>%\n      filter(year==input$yy) %>% \n      ggplot(aes(x=FEE, y=RATE, group=地區,color=地區)) + \n      geom_point(size=3)+theme(text=element_text(size=10, family=\"STHeiti\"))+\n      labs(title =\"保費與發生率的相關性\", x = \"每人平均保費\", y = \"發生率\")+\n      theme(axis.line = element_line(linetype = \"solid\"), \n            panel.grid.major = element_line(colour = \"gray84\"), \n            panel.grid.minor = element_line(colour = \"gray84\"), \n            axis.text.x = element_text(size = 15), \n            axis.text.y = element_text(size = 15), \n            panel.background = element_rect(fill = \"whitesmoke\", \n                                            linetype = \"solid\")) +\n      labs(subtitle = \"Scatter plot\", caption = '每個鄉鎮癌症患者的平均保費')\n    ggplotly(p,width = 700,height = 500)\n  })\n  # 趨勢性分析----\n  output$year_plot<-renderPlotly({\n    a <- DNRA%>%\n      filter(地區==input$area_b)%>%\n      ggplot(aes(x=year, y=RATE, group=cancer,color=cancer)) + \n      geom_point(size=2)+\n      geom_line()+\n      theme(text=element_text(size=10, family=\"STHeiti\"))+\n      labs(title =\"歷年癌症發生率變化\", x = \"年份\", y = \"發生率\")+\n      theme(axis.line = element_line(linetype = \"solid\"), \n            panel.grid.major = element_line(colour = \"gray84\"), \n            panel.grid.minor = element_line(colour = \"gray84\"), \n            axis.text.x = element_text(size = 15), \n            axis.text.y = element_text(size = 15), \n            panel.background = element_rect(fill = \"whitesmoke\", \n                                            linetype = \"solid\")) +\n      labs(subtitle = \"line chart\", caption = '')\n    ggplotly(a,width = 700,height = 500)\n\n  })\n  \n  \n  output$clustering <- renderHighchart({\n    # 雷達圖----\n    highchart() %>% \n      hc_chart(polar = TRUE, type = \"line\") %>% \n      hc_xAxis(categories = cluster$class,\n               tickmarkPlacement = 'on',\n               lineWidth = 0) %>% \n      hc_yAxis(gridLineInterpolation = 'polygon',\n               lineWidth = 0,\n               min = 0, max = 6) %>% \n      hc_series(\n        list(\n          name = \"Cluster-1\",\n          data = cluster$X1 %>% as.numeric(),\n          pointPlacement = 'on',color=col.raw[1]),\n        list(\n          name = \"Cluster-2\",\n          data = cluster$X2 %>% as.numeric(),\n          pointPlacement = 'on',color=col.raw[2]),\n        list(\n          name = \"Cluster-3\",\n          data = cluster$X3 %>% as.numeric(),\n          pointPlacement = 'on',color=col.raw[3]),\n        list(\n          name = \"Cluster-4\",\n          data = cluster$X4 %>% as.numeric(),\n          pointPlacement = 'on',color=col.raw[4]),\n        list(\n          name = \"Cluster-5\",\n          data = cluster$X5 %>% as.numeric(),\n          pointPlacement = 'on',color=col.raw[5]),\n        list(\n          name = \"Overall-Mean\",\n          data = cluster$mean ,\n          pointPlacement = 'on',color='#474747'))\n  })\n  \n  # red, yellow, aqua, blue, light-blue, green, navy, teal, olive, lime, orange, fuchsia, purple, maroon, black.\n  # 每萬人醫師數logo----\n  output$doctor <- renderInfoBox({\n    infoBox(\n      h4(\"每萬人醫師數\"),\n      p(\"。Town\",br(),\"。Manpower\"),icon = icon(\"user-md\"),\n      color = \"red\",fill =TRUE\n    )\n  })\n  # 每萬護理師數logo----\n  output$nurse <- renderInfoBox({\n    infoBox(\n      h4(\"每萬人護理師\"),\n      p(\"。Town\",br(),\"。Manpower\"),icon = icon(\"heartbeat\"),\n      color = \"blue\",fill =TRUE\n    )\n  })\n  # 荷爾蒙失調logo----\n  output$荷爾蒙失調 <- renderInfoBox({\n    infoBox(\n      \"The Name of the Clustering\", paste0(\"荷爾蒙失調\",\"\"),\n      p(\"。City\",br(),\"。Pressure\"),icon = icon(\"heart\"),\n      color = \"red\",fill =TRUE\n    )\n  })\n  # 飲食問題logo----\n  output$飲食問題 <- renderInfoBox({\n    infoBox(\n      \"The Name of the Clustering\", paste0(\"飲食問題\",\"\"),\n      p(\"。Digestive system\",br(),\"。Seafood\"),icon = icon(\"coffee\"),\n      color = \"light-blue\",fill =TRUE\n    )\n  })\n  # 平均常態族群logo----\n  output$平均常態族群 <- renderInfoBox({\n    infoBox(\n      \"The Name of the Clustering\", paste0(\"平均常態族群\",\"\"),\n      icon = icon(\"balance-scale\"),\n      color = \"blue\",fill =TRUE\n    )\n  })\n  # 農藥汙染logo----\n  output$農藥汙染 <- renderInfoBox({\n    infoBox(\n      \"The Name of the Clustering\", paste0(\"農藥汙染\",\"\"),\n      p(\"。Agriculture\"),icon = icon(\"leaf\"),\n      color = \"green\",fill =TRUE\n    )\n  })\n  # 地域性文化logo----\n  output$地域性文化 <- renderInfoBox({\n    infoBox(\n      \"The Name of the Clustering\", paste0(\"地域性文化\",\"\"),\n      p(\"。Local Culture\"),icon = icon(\"flag\"),\n      color = \"olive\",fill =TRUE\n    )\n  })\n  \n  output$clustermap <- renderLeaflet({\n    \n    # 畫分群地圖----\n    leaflet(\n      tw %>% subset(tw$COUNTYNAME %in% clusteringmap$county & tw$TOWNNAME %in% clusteringmap$city)) %>%\n      addPolygons(\n        stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5,\n        # popup是對話框的設定\n        popup = ~sprintf(\"<strong><span style=\\\"color:gray;\\\"> 縣市 </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> 鄉鎮 </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> 群 </span></strong></br>\n                         <span style=\\\"font-size:40px;\\\"> %s\",COUNTYNAME, TOWNNAME ,clusteringmap$clustering ),\n        color = ~pal(clusteringmap$clustering)) %>%\n      addLegend(\"bottomright\", pal = pal, values = ~clusteringmap$clustering,\n                title = \"群別\",\n                opacity = 0.5) %>% #透明度\n      # 這個是初始畫面，定位的位置\n      setView(lng = 120.5621971, lat = 23.35, zoom = 10) %>%\n      addProviderTiles(\"CartoDB.Positron\")\n  })\n  # 醫療院所地圖----\n  output$hos_map<-renderLeaflet({\n    DH%>%\n      select(1,2,3,4,5,8,9)%>%\n      leaflet() %>% addTiles() %>%\n      addCircleMarkers(\n        color = ~pal2(area),\n        stroke = FALSE, fillOpacity = 0.7,\n        popup = ~sprintf(\"<strong><span style=\\\"color:gray;\\\"> COUNTY </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> TOWN </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> Hospital_Name </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s </span></br>\n                         <strong><span style=\\\"color:gray;\\\"> Hospital_Level </span></strong></br>\n                         <span style=\\\"font-size:20px;\\\"> %s\",DH$city, DH$area ,DH$name,DH$level ),\n        label = ~as.character(name),radius = 7,group=\"地區\") %>%\n      addMarkers(icon = ~buildIcons[level],popup = ~as.character(level),group=\"醫療層級\")%>%\n      addLayersControl(overlayGroups = c(\"地區\", \"醫療層級\"), options = layersControlOptions(collapsed = FALSE)) %>%\n      addControl(html = html_legend, position = \"bottomright\") %>%\n      # addLegend(\"bottomright\", pal = pal3, values = ~level,\n      #           title = \"醫療層級\",\n      #           opacity = 0.5) %>%\n      addLegend(\"bottomright\", pal = pal2, values =  ~area,\n                title = \"鄉鎮市區\",\n                opacity = 0.5) %>%\n      setView(lng = 120.4473, lat = 23.47545, zoom = 12)\n  })\n  # 醫師人數圖----\n  output$doctor_plot<-renderPlotly({\n    b <- DO%>%\n      select(1,2,6) %>% \n      filter(year==input$doctor_year)%>%\n      ggplot(aes(x=reorder(area,-perdoctor),y=perdoctor))+\n      geom_bar(stat=\"identity\",fill=\"#4C8CE0\")+theme(text=element_text(size=10, family=\"STHeiti\"))+\n      labs(title =\"嘉義縣市各鄉鎮的每萬人醫師數\", x = \"鄉鎮市\", y = \"每萬人醫師數\")+\n      theme(axis.line = element_line(linetype = \"solid\"), \n            panel.grid.major = element_line(colour = \"gray84\"), \n            panel.grid.minor = element_line(colour = \"gray84\"), \n            axis.text.x = element_text(size = 9), \n            axis.text.y = element_text(size = 9), \n            panel.background = element_rect(fill = \"whitesmoke\", \n                                            linetype = \"solid\")) +\n      theme(axis.text.x = element_text(angle = 20)) +\n      labs(subtitle = NULL, caption = NULL)+\n      labs(subtitle = \"\", caption = '')\n    ggplotly(b,width = 700,height = 400)\n  }) \n  # 醫師趨勢圖----\n  output$yeardoctor_plot<-renderPlotly({\n    d <- DO %>% \n      select(1,2,6) %>% \n      ggplot(aes(x=year, y=perdoctor,color=area)) + \n      geom_point(size=2)+\n      geom_line()+theme(text=element_text(size=10, family=\"STHeiti\"))+\n      labs(title =\"嘉義縣市各年度每萬人醫師數\", x = \"年份\", y = \"每萬人醫師數\")+\n      theme(axis.line = element_line(linetype = \"solid\"), \n            panel.grid.major = element_line(colour = \"gray84\"), \n            panel.grid.minor = element_line(colour = \"gray84\"), \n            axis.text.x = element_text(size = 9), \n            axis.text.y = element_text(size = 9), \n            panel.background = element_rect(fill = \"whitesmoke\", \n                                            linetype = \"solid\")) +\n      theme(axis.text.x = element_text(angle = 20)) +\n      labs(subtitle = NULL, caption = NULL)+\n      labs(subtitle = \"\", caption = '')\n    ggplotly(d,width = 700,height = 400)\n  })\n  # 護理師人數----\n  output$nurse_plot<-renderPlotly({\n    c <- DO%>%\n      select(1,2,7) %>% \n      filter(year==input$nurse_year)%>%\n      ggplot(aes(x=reorder(area,-pernurse),y=pernurse))+\n      geom_bar(stat=\"identity\",fill=\"#4C8CE0\")+theme(text=element_text(size=10))+\n      labs(title =\"嘉義縣市各鄉鎮的每萬人護理師人數\", x = \"鄉鎮市\", y = \"每萬人護理師人數\")+\n      theme(axis.line = element_line(linetype = \"solid\"), \n            panel.grid.major = element_line(colour = \"gray84\"), \n            panel.grid.minor = element_line(colour = \"gray84\"), \n            axis.text.x = element_text(size = 9), \n            axis.text.y = element_text(size = 9), \n            panel.background = element_rect(fill = \"whitesmoke\", \n                                            linetype = \"solid\")) +\n      theme(axis.text.x = element_text(angle = 20)) +\n      labs(subtitle = NULL, caption = NULL)+\n      labs(subtitle = \"\", caption = '')\n    ggplotly(c,width = 700,height = 400)\n  }) \n  # 護理師趨勢圖----\n  output$yearnurse_plot<-renderPlotly({\n    e<- DO %>%\n      select(1,2,7) %>% \n      ggplot(aes(x=year, y=pernurse,color=area)) + \n      geom_point(size=2)+\n      geom_line()+theme(text=element_text(size=10, family=\"STHeiti\"))+\n      labs(title =\"嘉義縣市各鄉鎮的每萬人護理師人數\", x = \"鄉鎮市\", y = \"每萬人護理師人數\")+\n      theme(axis.line = element_line(linetype = \"solid\"), \n            panel.grid.major = element_line(colour = \"gray84\"), \n            panel.grid.minor = element_line(colour = \"gray84\"), \n            axis.text.x = element_text(size = 9), \n            axis.text.y = element_text(size = 9), \n            panel.background = element_rect(fill = \"whitesmoke\", \n                                            linetype = \"solid\")) +\n      theme(axis.text.x = element_text(angle = 20)) +\n      labs(subtitle = NULL, caption = NULL)+\n      labs(subtitle = \"\", caption = '')\n    ggplotly(e,width = 700,height = 400)\n  })\n}\n\nshinyApp(ui, server)\n\n\n\n\n\n\n\n",
    "created" : 1500137556553.000,
    "dirty" : false,
    "encoding" : "BIG5",
    "folds" : "",
    "hash" : "4010154603",
    "id" : "5EDD3961",
    "lastKnownWriteTime" : 1500182117,
    "last_content_update" : 1500182117840,
    "path" : "~/Downloads/Hackthon_chiayi/app/app.R",
    "project_path" : "app/app.R",
    "properties" : {
        "docOutlineVisible" : "1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}