ggplot(aes(x=year, y=pernurse,color=area)) +
geom_point(size=3)+
geom_line()+theme(text=element_text(size=10, family="STHeiti"))
ggplotly(e,width = 740,height = 600)
})
}
shinyApp(ui, server)
# library---------
library(shinydashboard)
library(shiny)
library(data.table)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(plotly)
library(highcharter)
library(leaflet)
library(rgdal)
library(maptools)
library(magrittr)
library(ggthemes)
library(readxl)
library(RColorBrewer)
library(ggThemeAssist)
options(max.print="75", digits = 4, scipen = 999)
# load data----
# 鄉鎮市地圖底圖設定，於開放資料平台下載----
tw <- readOGR(dsn ='leaflet_map/TOWN_MOI_1060525' ,
layer='TOWN_MOI_1060525', stringsAsFactors = F,
verbose = F,encoding = "utf8")
# Windows系統編碼問題，MAC系統不須執行
#tw$COUNTYNAME <- iconv(tw$COUNTYNAME,from ="utf8" ,to="big5")
#tw$TOWNNAME <- iconv(tw$TOWNNAME,from ="utf8" ,to="big5")
# 崇甫的資料----
cluster <- read.csv("data/clustering_index.csv",header = T,fileEncoding = 'big5') %>% select(-1)
# 家丞的資料----
DNRA <- read.csv("data/DNRA.csv",header = T,fileEncoding = 'big5') %>% select(-1)
DNRB <- read.csv("data/DNRB.csv",header = T,fileEncoding = 'big5') %>% select(-1)
DH<-read_excel("data/嘉義市醫療院所資料集.xlsx")
DO<-read_excel("data/醫療人員統計-醫師及護理師(長資料整合).xlsx")
colnames(DO)<-c("area","year","doctor","nurse","population","perdoctor","pernurse")
#醫療院所分佈用icon----
# c("#A88B14","#5A7DE0","#827E6D","#FFA500","#332D15")
pal2 <- colorFactor(palette=c("#00008B", "#00CD66", "#1C1C1C","#FFA500" , "#FF1493"), domain = c("西區", "東區","朴子市","竹崎鄉","大林鎮"))
pal3<- colorFactor(palette=c("#D80027","#BD7BE3","#0038F0"), domain = c("地區醫院","區域醫院","基層院所"))
buildIcons <- iconList(
區域醫院 = makeIcon("data/區域醫院.png"),
地區醫院 = makeIcon("data/地區醫院.png"),
基層院所 = makeIcon("data/診所.png")
)
leafIcons <- icons(
iconUrl = if (DH$level=="地區醫院") {
"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CjxwYXRoIHN0eWxlPSJmaWxsOiMwMDQ3OUI7IiBkPSJNMzA5LjcxNSwxNC42NGMtMjkuNjU5LTE3LjEyNC01Ni41MzEtMTguNzEzLTc1LjkzNS03LjQzOEwxMjcuMDUzLDY5LjIyNSAgYzAuMDYyLTAuMDM2LDAuMTI2LTAuMDY4LDAuMTg3LTAuMTA0Yy0xOS4yNjMsMTEuMDg2LTMxLjIxOCwzNC43OTYtMzEuMzE0LDY4LjU0NUM5NS43MzUsMjA1LjM5MiwxOTYuNDUxLDQ5Ni42NywyMDEuNzUyLDUxMiAgbDEwNi43MjgtNjIuMDIzYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTEsMTA3LjU5My0yNTEuMTE2QzQxNi4yNjYsMTMxLjE0MywzNjguNjQ4LDQ4LjY2NCwzMDkuNzE1LDE0LjY0eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA1RUNGOyIgZD0iTTEyNy4wNTMsNjkuMjI1TDIzMy43ODIsNy4yMDJjMTkuNDA0LTExLjI3Nyw0Ni4yNzUtOS42ODcsNzUuOTM1LDcuNDM4TDIwMi45ODgsNzYuNjYzICBDMTczLjMyOCw1OS41NCwxNDYuNDU3LDU3Ljk1LDEyNy4wNTMsNjkuMjI1eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA0NzlCOyIgZD0iTTIwMi45ODgsNzYuNjYzTDMwOS43MTUsMTQuNjRjNTguOTMyLDM0LjAyNCwxMDYuNTUxLDExNi41MDMsMTA2LjM1OSwxODQuMjIxICBjLTAuMTkyLDY3LjcyNS0xMDIuMjIzLDI0MS45NDYtMTA3LjU5MywyNTEuMTE2TDIwMS43NTMsNTEyYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTIsMTA3LjU5My0yNTEuMTE2ICBDMzA5LjUzOSwxOTMuMTY2LDI2MS45MTksMTEwLjY4NywyMDIuOTg4LDc2LjY2M3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6IzAwNEZBRTsiIGQ9Ik0yMDIuOTg4LDc2LjY2M2M1OC45MzIsMzQuMDI0LDEwNi41NTEsMTE2LjUwMywxMDYuMzU5LDE4NC4yMjEgIEMzMDkuMTU0LDMyOC42MDksMjA3LjEyMyw1MDIuODMsMjAxLjc1Myw1MTJDMTk2LjQ1Miw0OTYuNjcsOTUuNzM1LDIwNS4zOTIsOTUuOTI3LDEzNy42NjcgIEM5Ni4xMTksNjkuOTQ5LDE0NC4wNDksNDIuNjM1LDIwMi45ODgsNzYuNjYzeiIvPgo8Zz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS40NDUsMTQ4LjYxNiAxOTIuNTg2LDE3MC4wMzcgMTkyLjU0NywxODMuNzY4IDE4NC44ODgsMTc5LjI1NSAxODQuODg4LDEyMi44OTEgICAgMTQ4LjM3OSwxMDEuODEzIDExMS41MTksMTIzLjIzMyAxMTEuMDg2LDI3NS45NzcgMTQ3LjU5NiwyOTcuMDU2IDE4NC40NTUsMjc1LjYzNiAxODQuNTA0LDI1OC40NTggMTkyLjMyMiwyNjIuOTcyICAgIDE5Mi4xNTIsMzIyLjc4MSAyMjkuMDk1LDM0My44NTkgMjY1Ljk1MywzMjIuNDM5IDI2NS45NTMsMTY5LjY5NSAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojQUNBQkIxOyIgcG9pbnRzPSIxNDcuNzY1LDIzNy4yNDcgMTg0LjYyNSwyMTUuODI3IDE4NC40NTUsMjc1LjYzNiAxNDcuNTk2LDI5Ny4wNTYgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTQ4LjAyOSwyMDAuNjc1IDE4NC44ODgsMTc5LjI1NSAyMjkuMjg1LDIwNC45NzkgMTkyLjQyNSwyMjYuNCAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRTBFMEUyOyIgcG9pbnRzPSIxMTEuNTE5LDEyMy4yMzMgMTQ4LjM3OSwxMDEuODEzIDE4NC44ODgsMTIyLjg5MSAxNDguMDI5LDE0NC4zMTIgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0FDQUJCMTsiIHBvaW50cz0iMTQ4LjAyOSwxNDQuMzEyIDE4NC44ODgsMTIyLjg5MSAxODQuODg4LDE3OS4yNTUgMTQ4LjAyOSwyMDAuNjc1ICAiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS4wOTUsMTkxLjExNSAyNjUuOTUzLDE2OS42OTUgMjY1Ljk1MywzMjIuNDM5IDIyOS4wOTUsMzQzLjg1OSAgIi8+CjwvZz4KPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTkyLjU4NiwxNzAuMDM3IDIyOS40NDUsMTQ4LjYxNiAyNjUuOTUzLDE2OS42OTUgMjI5LjA5NSwxOTEuMTE1ICIvPgo8cG9seWdvbiBzdHlsZT0iZmlsbDojQzZDNUNCOyIgcG9pbnRzPSIyMjkuMDk1LDE5MS4xMTUgMjI5LjA5NSwzNDMuODU5IDE5Mi4xNTIsMzIyLjc4MSAxOTIuMzIyLDI2Mi45NzIgMTQ3Ljc2NSwyMzcuMjQ3ICAgMTQ3LjU5NiwyOTcuMDU2IDExMS4wODYsMjc1Ljk3NyAxMTEuNTE5LDEyMy4yMzMgMTQ4LjAyOSwxNDQuMzEyIDE0OC4wMjksMjAwLjY3NSAxOTIuNDI1LDIyNi40IDE5Mi41ODYsMTcwLjAzNyAiLz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="
} else if (DH$level=="區域醫院") {
"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ2MCA0NjAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ2MCA0NjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRUYxRjRCOyIgZD0iTTIzMCwwdjQwYzc1LjI2MywwLDEzNi41LDYxLjIyLDEzNi41LDEzNi41YzAsNzUuMjYzLTYxLjIzNywxMzYuNS0xMzYuNSwxMzYuNXYxNDdsMTM4LjUxMS0xNzQuMTQ0ICAgYzI0Ljg2OC0zMS40NTIsMzguMDE3LTY5LjI1LDM4LjAxNy0xMDkuMzI5QzQwNi41MjcsNzkuMTkyLDMyNy4zMzUsMCwyMzAsMHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNFQTY0NTM7IiBkPSJNOTMuNSwxNzYuNUM5My41LDEwMS4yMiwxNTQuNzM3LDQwLDIzMCw0MFYwQzEzMi42NjUsMCw1My40NzMsNzkuMTkyLDUzLjQ3MywxNzYuNTI3ICAgYzAsNDAuMDc5LDEzLjE0OCw3Ny44NzcsMzguMDU0LDEwOS4zNjdMMjMwLDQ2MFYzMTNDMTU0LjczNywzMTMsOTMuNSwyNTEuNzYzLDkzLjUsMTc2LjV6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkZFMjkyOyIgZD0iTTI2Mi40NTksODB2NjQuMDQxSDMyNi41djY0LjkxOGgtNjQuMDQxVjI3M0gyMzB2NDBjNzUuMjYzLDAsMTM2LjUtNjEuMjM3LDEzNi41LTEzNi41ICAgQzM2Ni41LDEwMS4yMiwzMDUuMjYzLDQwLDIzMCw0MHY0MEgyNjIuNDU5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIGQ9Ik05My41LDE3Ni41QzkzLjUsMjUxLjc2MywxNTQuNzM3LDMxMywyMzAsMzEzdi00MGgtMzIuNDU5di02NC4wNDFIMTMzLjV2LTY0LjkxOGg2NC4wNDFWODBIMjMwVjQwICAgQzE1NC43MzcsNDAsOTMuNSwxMDEuMjIsOTMuNSwxNzYuNXoiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiMwQjM4OUM7IiBwb2ludHM9IjI2Mi40NTksMjA4Ljk1OSAzMjYuNSwyMDguOTU5IDMyNi41LDE0NC4wNDEgMjYyLjQ1OSwxNDQuMDQxIDI2Mi40NTksODAgMjMwLDgwIDIzMCwyNzMgICAgMjYyLjQ1OSwyNzMgICIvPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6IzQzNzBEOTsiIHBvaW50cz0iMTk3LjU0MSw4MCAxOTcuNTQxLDE0NC4wNDEgMTMzLjUsMTQ0LjA0MSAxMzMuNSwyMDguOTU5IDE5Ny41NDEsMjA4Ljk1OSAxOTcuNTQxLDI3MyAgICAyMzAsMjczIDIzMCw4MCAgIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="
} else {
"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDMxLjc4NSAzMS43ODUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMxLjc4NSAzMS43ODU7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNMTcuOTQzLDguNzY5YzAtMC40NzktMC4zODktMC44NjgtMC44NjktMC44NjhoLTIuNTAyYy0wLjQ3OSwwLTAuODY4LDAuMzg5LTAuODY4LDAuODY4djIuMzgyaC0yLjUyMyAgICBjLTAuNDc5LDAtMC44NjgsMC4zODktMC44NjgsMC44Njh2Mi41MDFjMCwwLjQ3OSwwLjM4OSwwLjg2OSwwLjg2OCwwLjg2OWgyLjUyM3YyLjUyM2MwLDAuNDc5LDAuMzg5LDAuODY5LDAuODY4LDAuODY5aDIuNTAyICAgIGMwLjQ3OSwwLDAuODY5LTAuMzkxLDAuODY5LTAuODY5VjE1LjM5aDIuMzgxYzAuNDc5LDAsMC44NjktMC4zOSwwLjg2OS0wLjg2OVYxMi4wMmMwLTAuNDc5LTAuMzg5LTAuODY4LTAuODY5LTAuODY4aC0yLjM4MSAgICBWOC43Njl6IiBmaWxsPSIjOTMzRUM1Ii8+CgkJPHBhdGggZD0iTTE1Ljg5NCwwQzguOTk5LDAsMy4zODksNS42MDgsMy4zODksMTIuNTAyYzAsOS4yMTcsMTAuOTEzLDE4LjQ4MiwxMS4zNzcsMTguODcyYzAuNjE0LDAuNTE3LDEuNSwwLjU0OSwyLjE1MiwwLjA4MSAgICBjMC40NjgtMC4zMzcsMTEuNDc5LTguMzgsMTEuNDc5LTE4Ljk1M0MyOC4zOTYsNS42MDgsMjIuNzg3LDAsMTUuODk0LDB6IE0xNy4zMSwyNi41MzZjLTAuNzUxLDAuNzAzLTEuOTI1LDAuNjc3LTIuNjQ0LTAuMDYgICAgYy0zLjI5Ni0zLjM2Ny03Ljc3LTkuMDQxLTcuNzctMTMuOTc2YzAtNC45NTksNC4wMzctOC45OTYsOC45OTgtOC45OTZjNC45NTksMCw4Ljk5Niw0LjAzNyw4Ljk5Niw4Ljk5NiAgICBDMjQuODg5LDE4LjQ3NywyMC4yNzcsMjMuNzU4LDE3LjMxLDI2LjUzNnoiIGZpbGw9IiM5MzNFQzUiLz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K"
},
iconWidth = 38, iconHeight = 95,
iconAnchorX = 22, iconAnchorY = 94)
html_legend <-"<img src='data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCI+CjxwYXRoIHN0eWxlPSJmaWxsOiMwMDQ3OUI7IiBkPSJNMzA5LjcxNSwxNC42NGMtMjkuNjU5LTE3LjEyNC01Ni41MzEtMTguNzEzLTc1LjkzNS03LjQzOEwxMjcuMDUzLDY5LjIyNSAgYzAuMDYyLTAuMDM2LDAuMTI2LTAuMDY4LDAuMTg3LTAuMTA0Yy0xOS4yNjMsMTEuMDg2LTMxLjIxOCwzNC43OTYtMzEuMzE0LDY4LjU0NUM5NS43MzUsMjA1LjM5MiwxOTYuNDUxLDQ5Ni42NywyMDEuNzUyLDUxMiAgbDEwNi43MjgtNjIuMDIzYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTEsMTA3LjU5My0yNTEuMTE2QzQxNi4yNjYsMTMxLjE0MywzNjguNjQ4LDQ4LjY2NCwzMDkuNzE1LDE0LjY0eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA1RUNGOyIgZD0iTTEyNy4wNTMsNjkuMjI1TDIzMy43ODIsNy4yMDJjMTkuNDA0LTExLjI3Nyw0Ni4yNzUtOS42ODcsNzUuOTM1LDcuNDM4TDIwMi45ODgsNzYuNjYzICBDMTczLjMyOCw1OS41NCwxNDYuNDU3LDU3Ljk1LDEyNy4wNTMsNjkuMjI1eiIvPgo8cGF0aCBzdHlsZT0iZmlsbDojMDA0NzlCOyIgZD0iTTIwMi45ODgsNzYuNjYzTDMwOS43MTUsMTQuNjRjNTguOTMyLDM0LjAyNCwxMDYuNTUxLDExNi41MDMsMTA2LjM1OSwxODQuMjIxICBjLTAuMTkyLDY3LjcyNS0xMDIuMjIzLDI0MS45NDYtMTA3LjU5MywyNTEuMTE2TDIwMS43NTMsNTEyYzUuMzctOS4xNywxMDcuNDAxLTE4My4zOTIsMTA3LjU5My0yNTEuMTE2ICBDMzA5LjUzOSwxOTMuMTY2LDI2MS45MTksMTEwLjY4NywyMDIuOTg4LDc2LjY2M3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6IzAwNEZBRTsiIGQ9Ik0yMDIuOTg4LDc2LjY2M2M1OC45MzIsMzQuMDI0LDEwNi41NTEsMTE2LjUwMywxMDYuMzU5LDE4NC4yMjEgIEMzMDkuMTU0LDMyOC42MDksMjA3LjEyMyw1MDIuODMsMjAxLjc1Myw1MTJDMTk2LjQ1Miw0OTYuNjcsOTUuNzM1LDIwNS4zOTIsOTUuOTI3LDEzNy42NjcgIEM5Ni4xMTksNjkuOTQ5LDE0NC4wNDksNDIuNjM1LDIwMi45ODgsNzYuNjYzeiIvPgo8Zz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS40NDUsMTQ4LjYxNiAxOTIuNTg2LDE3MC4wMzcgMTkyLjU0NywxODMuNzY4IDE4NC44ODgsMTc5LjI1NSAxODQuODg4LDEyMi44OTEgICAgMTQ4LjM3OSwxMDEuODEzIDExMS41MTksMTIzLjIzMyAxMTEuMDg2LDI3NS45NzcgMTQ3LjU5NiwyOTcuMDU2IDE4NC40NTUsMjc1LjYzNiAxODQuNTA0LDI1OC40NTggMTkyLjMyMiwyNjIuOTcyICAgIDE5Mi4xNTIsMzIyLjc4MSAyMjkuMDk1LDM0My44NTkgMjY1Ljk1MywzMjIuNDM5IDI2NS45NTMsMTY5LjY5NSAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojQUNBQkIxOyIgcG9pbnRzPSIxNDcuNzY1LDIzNy4yNDcgMTg0LjYyNSwyMTUuODI3IDE4NC40NTUsMjc1LjYzNiAxNDcuNTk2LDI5Ny4wNTYgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTQ4LjAyOSwyMDAuNjc1IDE4NC44ODgsMTc5LjI1NSAyMjkuMjg1LDIwNC45NzkgMTkyLjQyNSwyMjYuNCAgIi8+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRTBFMEUyOyIgcG9pbnRzPSIxMTEuNTE5LDEyMy4yMzMgMTQ4LjM3OSwxMDEuODEzIDE4NC44ODgsMTIyLjg5MSAxNDguMDI5LDE0NC4zMTIgICIvPgo8L2c+CjxnPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0FDQUJCMTsiIHBvaW50cz0iMTQ4LjAyOSwxNDQuMzEyIDE4NC44ODgsMTIyLjg5MSAxODQuODg4LDE3OS4yNTUgMTQ4LjAyOSwyMDAuNjc1ICAiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiNBQ0FCQjE7IiBwb2ludHM9IjIyOS4wOTUsMTkxLjExNSAyNjUuOTUzLDE2OS42OTUgMjY1Ljk1MywzMjIuNDM5IDIyOS4wOTUsMzQzLjg1OSAgIi8+CjwvZz4KPHBvbHlnb24gc3R5bGU9ImZpbGw6I0UwRTBFMjsiIHBvaW50cz0iMTkyLjU4NiwxNzAuMDM3IDIyOS40NDUsMTQ4LjYxNiAyNjUuOTUzLDE2OS42OTUgMjI5LjA5NSwxOTEuMTE1ICIvPgo8cG9seWdvbiBzdHlsZT0iZmlsbDojQzZDNUNCOyIgcG9pbnRzPSIyMjkuMDk1LDE5MS4xMTUgMjI5LjA5NSwzNDMuODU5IDE5Mi4xNTIsMzIyLjc4MSAxOTIuMzIyLDI2Mi45NzIgMTQ3Ljc2NSwyMzcuMjQ3ICAgMTQ3LjU5NiwyOTcuMDU2IDExMS4wODYsMjc1Ljk3NyAxMTEuNTE5LDEyMy4yMzMgMTQ4LjAyOSwxNDQuMzEyIDE0OC4wMjksMjAwLjY3NSAxOTIuNDI1LDIyNi40IDE5Mi41ODYsMTcwLjAzNyAiLz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=='> 地區醫院 <br/>
<img src='data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQ2MCA0NjAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ2MCA0NjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRUYxRjRCOyIgZD0iTTIzMCwwdjQwYzc1LjI2MywwLDEzNi41LDYxLjIyLDEzNi41LDEzNi41YzAsNzUuMjYzLTYxLjIzNywxMzYuNS0xMzYuNSwxMzYuNXYxNDdsMTM4LjUxMS0xNzQuMTQ0ICAgYzI0Ljg2OC0zMS40NTIsMzguMDE3LTY5LjI1LDM4LjAxNy0xMDkuMzI5QzQwNi41MjcsNzkuMTkyLDMyNy4zMzUsMCwyMzAsMHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNFQTY0NTM7IiBkPSJNOTMuNSwxNzYuNUM5My41LDEwMS4yMiwxNTQuNzM3LDQwLDIzMCw0MFYwQzEzMi42NjUsMCw1My40NzMsNzkuMTkyLDUzLjQ3MywxNzYuNTI3ICAgYzAsNDAuMDc5LDEzLjE0OCw3Ny44NzcsMzguMDU0LDEwOS4zNjdMMjMwLDQ2MFYzMTNDMTU0LjczNywzMTMsOTMuNSwyNTEuNzYzLDkzLjUsMTc2LjV6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkZFMjkyOyIgZD0iTTI2Mi40NTksODB2NjQuMDQxSDMyNi41djY0LjkxOGgtNjQuMDQxVjI3M0gyMzB2NDBjNzUuMjYzLDAsMTM2LjUtNjEuMjM3LDEzNi41LTEzNi41ICAgQzM2Ni41LDEwMS4yMiwzMDUuMjYzLDQwLDIzMCw0MHY0MEgyNjIuNDU5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIGQ9Ik05My41LDE3Ni41QzkzLjUsMjUxLjc2MywxNTQuNzM3LDMxMywyMzAsMzEzdi00MGgtMzIuNDU5di02NC4wNDFIMTMzLjV2LTY0LjkxOGg2NC4wNDFWODBIMjMwVjQwICAgQzE1NC43MzcsNDAsOTMuNSwxMDEuMjIsOTMuNSwxNzYuNXoiLz4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOiMwQjM4OUM7IiBwb2ludHM9IjI2Mi40NTksMjA4Ljk1OSAzMjYuNSwyMDguOTU5IDMyNi41LDE0NC4wNDEgMjYyLjQ1OSwxNDQuMDQxIDI2Mi40NTksODAgMjMwLDgwIDIzMCwyNzMgICAgMjYyLjQ1OSwyNzMgICIvPgoJPHBvbHlnb24gc3R5bGU9ImZpbGw6IzQzNzBEOTsiIHBvaW50cz0iMTk3LjU0MSw4MCAxOTcuNTQxLDE0NC4wNDEgMTMzLjUsMTQ0LjA0MSAxMzMuNSwyMDguOTU5IDE5Ny41NDEsMjA4Ljk1OSAxOTcuNTQxLDI3MyAgICAyMzAsMjczIDIzMCw4MCAgIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=='> 區域醫院 <br/>
<img src='data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDMxLjc4NSAzMS43ODUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMxLjc4NSAzMS43ODU7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNMTcuOTQzLDguNzY5YzAtMC40NzktMC4zODktMC44NjgtMC44NjktMC44NjhoLTIuNTAyYy0wLjQ3OSwwLTAuODY4LDAuMzg5LTAuODY4LDAuODY4djIuMzgyaC0yLjUyMyAgICBjLTAuNDc5LDAtMC44NjgsMC4zODktMC44NjgsMC44Njh2Mi41MDFjMCwwLjQ3OSwwLjM4OSwwLjg2OSwwLjg2OCwwLjg2OWgyLjUyM3YyLjUyM2MwLDAuNDc5LDAuMzg5LDAuODY5LDAuODY4LDAuODY5aDIuNTAyICAgIGMwLjQ3OSwwLDAuODY5LTAuMzkxLDAuODY5LTAuODY5VjE1LjM5aDIuMzgxYzAuNDc5LDAsMC44NjktMC4zOSwwLjg2OS0wLjg2OVYxMi4wMmMwLTAuNDc5LTAuMzg5LTAuODY4LTAuODY5LTAuODY4aC0yLjM4MSAgICBWOC43Njl6IiBmaWxsPSIjOTMzRUM1Ii8+CgkJPHBhdGggZD0iTTE1Ljg5NCwwQzguOTk5LDAsMy4zODksNS42MDgsMy4zODksMTIuNTAyYzAsOS4yMTcsMTAuOTEzLDE4LjQ4MiwxMS4zNzcsMTguODcyYzAuNjE0LDAuNTE3LDEuNSwwLjU0OSwyLjE1MiwwLjA4MSAgICBjMC40NjgtMC4zMzcsMTEuNDc5LTguMzgsMTEuNDc5LTE4Ljk1M0MyOC4zOTYsNS42MDgsMjIuNzg3LDAsMTUuODk0LDB6IE0xNy4zMSwyNi41MzZjLTAuNzUxLDAuNzAzLTEuOTI1LDAuNjc3LTIuNjQ0LTAuMDYgICAgYy0zLjI5Ni0zLjM2Ny03Ljc3LTkuMDQxLTcuNzctMTMuOTc2YzAtNC45NTksNC4wMzctOC45OTYsOC45OTgtOC45OTZjNC45NTksMCw4Ljk5Niw0LjAzNyw4Ljk5Niw4Ljk5NiAgICBDMjQuODg5LDE4LjQ3NywyMC4yNzcsMjMuNzU4LDE3LjMxLDI2LjUzNnoiIGZpbGw9IiM5MzNFQzUiLz4KCTwvZz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K'>基層院所"
# 分群的資料----
clusteringmap <- read.csv("data/clusteringmap.csv",header = T,fileEncoding = 'big5') %>% select(-1)
# 昶志的資料----
white=read.csv(file="data/嘉義年度疾病發生率.csv",h=T,fileEncoding = "big5")
county <- tw$COUNTYNAME[which(tw$COUNTYNAME %in% c("嘉義縣","嘉義市"))]
county <- as.data.frame(county)
county <- county %>% mutate(city=tw$TOWNNAME[which(tw$COUNTYNAME %in% c("嘉義縣","嘉義市"))])
colnames(white)[1]="city"
white<- inner_join(county,white,by=c("city"))
#調整分群地圖顏色----
col.raw <-  c("#FB9A99","#A6CEE3","#1F78B4","#B2DF8A","#33A02C","#E31A1C","#FDBF6F"
,"#FF7F00","#CAB2D6","#6A3D9A")
pal <- colorFactor(
palette = c(col.raw[1],col.raw[2],col.raw[3],col.raw[4],col.raw[5]),
domain = clusteringmap$clustering
)
# 調整雷達塗顏色highcharter color----
col.raw <-  c("#FB9A99","#A6CEE3","#1F78B4","#B2DF8A","#33A02C","#E31A1C","#FDBF6F"
,"#FF7F00","#CAB2D6","#6A3D9A")
cbind(grDevices::col2rgb(col.raw),3) -> col
# ui----
ui <- dashboardPage(skin = "yellow",
dashboardHeader(title = "Hackthon for Chiayi City",titleWidth = 200),
# sidebarMenu----
dashboardSidebar(width = 200,
sidebarMenu(
menuItem("疾病發生率", tabName = "overview", icon = icon("percent")),
menuItem("相關性及趨勢分析", tabName = "area", icon = icon("line-chart")),
menuItem("癌症發生率之分群分析", tabName = "clustering", icon = icon("users")),
menuItem("醫療資源分布", tabName = "hospitalmap", icon = icon("ambulance")),
menuItem("作者簡介", tabName = "writer", icon = icon("address-card"))
)
),
dashboardBody(
tabItems(
# 疾病發生率----
tabItem(tabName = "overview",
fluidRow(
# column(
#   width = 3,
#   box(width = NULL, status = 'info', height = 200, title = "各類癌症相關查詢: ",
#       solidHeader = T,
#       selectInput('cancer_type',
#                   label = "選擇癌症",
#                   choices = unique(white$cancer),
#                   selected = "白血病"),
#       selectInput('year_d',
#                   label = "年份",
#                   choices = unique(white$year),
#                   selected = 2004)
#   )),
column(width = 12,
box(width = NULL, solidHeader = TRUE,
leafletOutput("map", height = "600px", width = 'auto'),
absolutePanel(top = 50, right = 100, draggable = T,
selectInput('cancer_type', label = "選擇癌症",
choices = unique(white$cancer), multiple = FALSE, selected = "卵巢.輸卵管及寬韌帶"),
selectInput('year_d', label = "選擇年份",
choices = unique(white$year), multiple = FALSE, selected = 2004)
)
)
)
)
),
# 分群----
tabItem(tabName = "clustering",
fluidRow(
column(
width = 4,
box(width = NULL, status = 'warning', height = 600,
infoBoxOutput("荷爾蒙失調",width = 100),
infoBoxOutput("飲食問題",width = 100),
infoBoxOutput("平均常態族群",width = 100),
infoBoxOutput("農藥汙染",width = 100),
infoBoxOutput("地域性文化",width = 100)
)
),
box(width = 8, status = 'warning', height = 600, title = "分群結果：",
highchartOutput(outputId = "clustering",height = 550)
)
),
fluidRow(
column(width = 12,
box(width = NULL, solidHeader = TRUE,
leafletOutput("clustermap", height = 500)
)
)
)
),
# 相關性及趨勢分析----
tabItem(tabName = "area",
fluidRow(
column(
width = 3,
box(width = NULL, status = 'primary', height = 600, title = "功能查詢: ",
solidHeader = T,
selectInput('cancer_t',
label = "選擇癌症",
choices = unique(DNRB$cancer),
selected = "胰"),
selectInput('yy',
label = "選擇年份",
choices = unique(DNRB$year),
selected = 2008),
infoBoxOutput("癌症分析",width=100),
br(),
br(),
br(),
br(),
br(),
br(),
selectInput('area_b',
label = "選擇鄉鎮",
choices = unique(DNRA$地區),
selected = "嘉義市東區"),
infoBoxOutput("趨勢分析",width=100)
)
),
column(
width = 9,
tabBox(
width = 12,height = 600,
tabPanel(h5("癌症與保費相關性"),height=700,
plotlyOutput("cancer_plot")),
tabPanel(h5('年度趨勢圖'), height = 700,
plotlyOutput("year_plot"))
)
)
)
),
# 醫療資源----
tabItem(tabName = "hospitalmap",
fluidRow(
column(width = 12,
box(width = NULL, solidHeader = TRUE,
leafletOutput("hos_map", height = 500)
)
)
),
fluidRow(
column(
width = 3,
box(width = NULL, status = 'warning', height = 200, title = "每萬人醫師數查詢: ",
solidHeader = T,
selectInput('doctor_year',
label = "年份",
choices = unique(DO$year),
selected = 2004)
)),
column(
width = 9,
tabBox(
width = 12,height=700,
tabPanel(h5('每萬人醫師數'), status = 'warning', height = 700,
plotlyOutput("doctor_plot")),
tabPanel(h5('醫師年度趨勢圖'), status = 'warning', height = 700,
plotlyOutput("yeardoctor_plot"))
))
),
fluidRow(
column(
width = 3,
box(width = NULL, status = 'warning', height = 200, title = "每萬人護理師數查詢: ",
solidHeader = T,
selectInput('nurse_year',
label = "年份",
choices = unique(DO$year),
selected = 2004)
)),
column(
width = 9,
tabBox(
width = 12,height=700,
tabPanel(h5('每萬人護理師數'), status = 'warning', height = 700,
plotlyOutput("nurse_plot")),
tabPanel(h5('護理師年度趨勢圖'), status = 'warning', height = 700,
plotlyOutput("yearnurse_plot")
)
)
)
)
)
)
)
)
server <- function(input, output) {
# 發生率地圖----
output$map <- renderLeaflet({
white_1=white%>%
filter(cancer==input$cancer_type & year==input$year_d)
# filter(year==input$year_d)
pal <- colorNumeric(
palette = "Reds",
domain = white_1$RATE ,
reverse = F)
myLabelFormat = function(..., reverse_order = FALSE){
if(reverse_order){
function(type = "numeric", cuts){
cuts <- sort(cuts, decreasing = T)
}
}else{
labelFormat(...)
}
}
leaflet(
tw %>% subset(tw$COUNTYNAME %in% white_1$county & tw$TOWNNAME %in% white_1$city)) %>%
addPolygons(
stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5,
# popup是對話框的設定
popup = ~sprintf("<strong><span style=\"color:gray;\"> 縣市 </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> 鄉鎮 </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> 發生率 </span></strong></br>
<span style=\"font-size:40px;\"> %s",COUNTYNAME, TOWNNAME ,white_1$RATE ),
color = ~pal(white_1$RATE)) %>%
addLegend("bottomright",
values = ~white_1$RATE,
pal = pal,
#colors=rev(pal(white_1$RATE%>% sort() %>% unique())),
#labels=rev(white_1$RATE %>% sort() %>% unique()),
title = "發生率",
labFormat=labelFormat(suffix = '/十萬人'),
# labFormat = myLabelFormat(reverse_order = T),
opacity = 0.5) %>% #透明度
# 這個是初始畫面，定位的位置
setView(lng = 120.5621971, lat = 23.35, zoom = 10) %>%
addProviderTiles("CartoDB.Positron")
})
# 相關性分析logo----
output$癌症分析 <- renderInfoBox({
infoBox(h4("Correlation"),
p("。全民健保",br(),"。發生率"),icon = icon("h-square"),
color = "light-blue",fill =TRUE
)
})
# 趨勢性分析logo----
output$趨勢分析 <- renderInfoBox({
infoBox(h4(paste0("Cancer","Trend")),
p("。年份",br(),"。鄉鎮",br(),"。發生率"),icon = icon("plus-square"),
color = "orange",fill =TRUE
)
})
# 相關性分析----
output$cancer_plot<-renderPlotly({
p <- DNRB%>%
filter(cancer==input$cancer_t)%>%
filter(year==input$yy) %>%
ggplot(aes(x=FEE, y=RATE, group=地區,color=地區)) +
geom_point(size=3)+theme(text=element_text(size=10, family="STHeiti"))+
labs(title ="保費與發生率的相關性", x = "每人平均保費", y = "發生率")+
theme(axis.line = element_line(linetype = "solid"),
panel.grid.major = element_line(colour = "gray84"),
panel.grid.minor = element_line(colour = "gray84"),
axis.text.x = element_text(size = 15),
axis.text.y = element_text(size = 15),
panel.background = element_rect(fill = "whitesmoke",
linetype = "solid")) +
labs(subtitle = "Scatter plot", caption = '每個鄉鎮癌症患者的平均保費')
ggplotly(p,width = 700,height = 500)
})
# 趨勢性分析----
output$year_plot<-renderPlotly({
a <- DNRA%>%
filter(地區==input$area_b)%>%
ggplot(aes(x=year, y=RATE, group=cancer,color=cancer)) +
geom_point(size=2)+
geom_line()+
theme(text=element_text(size=10, family="STHeiti"))+
labs(title ="歷年癌症發生率變化", x = "年份", y = "發生率")+
theme(axis.line = element_line(linetype = "solid"),
panel.grid.major = element_line(colour = "gray84"),
panel.grid.minor = element_line(colour = "gray84"),
axis.text.x = element_text(size = 15),
axis.text.y = element_text(size = 15),
panel.background = element_rect(fill = "whitesmoke",
linetype = "solid")) +
labs(subtitle = "line chart", caption = '')
ggplotly(a,width = 700,height = 500)
})
output$clustering <- renderHighchart({
# 雷達圖----
highchart() %>%
hc_chart(polar = TRUE, type = "line") %>%
hc_xAxis(categories = cluster$class,
tickmarkPlacement = 'on',
lineWidth = 0) %>%
hc_yAxis(gridLineInterpolation = 'polygon',
lineWidth = 0,
min = 0, max = 6) %>%
hc_series(
list(
name = "Cluster-1",
data = cluster$X1 %>% as.numeric(),
pointPlacement = 'on',color=col.raw[1]),
list(
name = "Cluster-2",
data = cluster$X2 %>% as.numeric(),
pointPlacement = 'on',color=col.raw[2]),
list(
name = "Cluster-3",
data = cluster$X3 %>% as.numeric(),
pointPlacement = 'on',color=col.raw[3]),
list(
name = "Cluster-4",
data = cluster$X4 %>% as.numeric(),
pointPlacement = 'on',color=col.raw[4]),
list(
name = "Cluster-5",
data = cluster$X5 %>% as.numeric(),
pointPlacement = 'on',color=col.raw[5]),
list(
name = "Overall-Mean",
data = cluster$mean ,
pointPlacement = 'on',color='#474747'))
})
# red, yellow, aqua, blue, light-blue, green, navy, teal, olive, lime, orange, fuchsia, purple, maroon, black.
# 荷爾蒙失調logo----
output$荷爾蒙失調 <- renderInfoBox({
infoBox(
"The Name of the Clustering", paste0("荷爾蒙失調",""),
p("。City",br(),"。Pressure"),icon = icon("heart"),
color = "red",fill =TRUE
)
})
# 飲食問題logo----
output$飲食問題 <- renderInfoBox({
infoBox(
"The Name of the Clustering", paste0("飲食問題",""),
p("。Digestive system",br(),"。Seafood"),icon = icon("coffee"),
color = "light-blue",fill =TRUE
)
})
# 平均常態族群logo----
output$平均常態族群 <- renderInfoBox({
infoBox(
"The Name of the Clustering", paste0("平均常態族群",""),
icon = icon("balance-scale"),
color = "blue",fill =TRUE
)
})
# 農藥汙染logo----
output$農藥汙染 <- renderInfoBox({
infoBox(
"The Name of the Clustering", paste0("農藥汙染",""),
p("。Agriculture"),icon = icon("leaf"),
color = "green",fill =TRUE
)
})
# 地域性文化logo----
output$地域性文化 <- renderInfoBox({
infoBox(
"The Name of the Clustering", paste0("地域性文化",""),
p("。Local Culture"),icon = icon("flag"),
color = "olive",fill =TRUE
)
})
output$clustermap <- renderLeaflet({
# 畫分群地圖----
leaflet(
tw %>% subset(tw$COUNTYNAME %in% clusteringmap$county & tw$TOWNNAME %in% clusteringmap$city)) %>%
addPolygons(
stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5,
# popup是對話框的設定
popup = ~sprintf("<strong><span style=\"color:gray;\"> 縣市 </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> 鄉鎮 </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> 群 </span></strong></br>
<span style=\"font-size:40px;\"> %s",COUNTYNAME, TOWNNAME ,clusteringmap$clustering ),
color = ~pal(clusteringmap$clustering)) %>%
addLegend("bottomright", pal = pal, values = ~clusteringmap$clustering,
title = "群別",
opacity = 0.5) %>% #透明度
# 這個是初始畫面，定位的位置
setView(lng = 120.5621971, lat = 23.35, zoom = 10) %>%
addProviderTiles("CartoDB.Positron")
})
# 醫療院所地圖----
output$hos_map<-renderLeaflet({
DH%>%
select(1,2,3,4,5,8,9)%>%
leaflet() %>% addTiles() %>%
addCircleMarkers(
color = ~pal2(area),
stroke = FALSE, fillOpacity = 0.7,
popup = ~sprintf("<strong><span style=\"color:gray;\"> COUNTY </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> TOWN </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> Hospital_Name </span></strong></br>
<span style=\"font-size:20px;\"> %s </span></br>
<strong><span style=\"color:gray;\"> Hospital_Level </span></strong></br>
<span style=\"font-size:20px;\"> %s",DH$city, DH$area ,DH$name,DH$level ),
label = ~as.character(name),radius = 7,group="地區") %>%
addMarkers(icon = ~buildIcons[level],popup = ~as.character(level),group="醫療層級")%>%
addLayersControl(overlayGroups = c("地區", "醫療層級"), options = layersControlOptions(collapsed = FALSE)) %>%
addControl(html = html_legend, position = "bottomright") %>%
# addLegend("bottomright", pal = pal3, values = ~level,
#           title = "醫療層級",
#           opacity = 0.5) %>%
addLegend("bottomright", pal = pal2, values =  ~area,
title = "鄉鎮市區",
opacity = 0.5) %>%
setView(lng = 120.4473, lat = 23.47545, zoom = 12)
})
# 醫師人數圖----
output$doctor_plot<-renderPlotly({
b <- DO%>%
select(1,2,6) %>%
filter(year==input$doctor_year)%>%
ggplot(aes(x=reorder(area,-perdoctor),y=perdoctor))+
geom_bar(stat="identity",fill="orange")+theme(text=element_text(size=10))+
xlab("鄉鎮市")+
ylab("每萬人醫師數")
ggplotly(b,width = 740,height = 600)
})
# 醫師趨勢圖----
output$yeardoctor_plot<-renderPlotly({
d <- DO%>%
select(1,2,6) %>%
ggplot(aes(x=year, y=perdoctor,color=area)) +
geom_point(size=3)+
geom_line()+theme(text=element_text(size=10, family="STHeiti"))
ggplotly(d,width = 740,height = 600)
})
# 護理師人數----
output$nurse_plot<-renderPlotly({
c <- DO%>%
select(1,2,7) %>%
filter(year==input$nurse_year)%>%
ggplot(aes(x=reorder(area,-pernurse),y=pernurse))+
geom_bar(stat="identity",fill="orange")+theme(text=element_text(size=10))+
xlab("鄉鎮市")+
ylab("每萬人護理師數")
ggplotly(c,width = 740,height = 600)
})
# 護理師趨勢圖----
output$yearnurse_plot<-renderPlotly({
e<- DO%>%
select(1,2,7) %>%
ggplot(aes(x=year, y=pernurse,color=area)) +
geom_point(size=3)+
geom_line()+theme(text=element_text(size=10, family="STHeiti"))
ggplotly(e,width = 740,height = 600)
})
}
shinyApp(ui, server)
